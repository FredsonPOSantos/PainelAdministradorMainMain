<!-- Ficheiro: frontend/pages/admin_raffles.html -->

<div class="page-header">
    <h3>Ferramentas - Sorteios</h3>
</div>

<!-- Formulário de Criação -->
<div class="content-section">
    <div class="section-header">
        <h4>Criar Novo Sorteio</h4>
    </div>
    <form id="createRaffleForm">
        <div class="input-group">
            <label for="raffleTitle">Título do Sorteio</label>
            <input type="text" id="raffleTitle" required>
        </div>
        <div class="input-group">
            <label for="raffleObservation">Observação (Opcional)</label>
            <textarea id="raffleObservation" rows="3"></textarea>
        </div>
        
        <div class="section-header" style="margin-top: 20px;">
            <h5>Filtros para Participantes</h5>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="input-group">
                <label for="filterCampaign">Campanha (Opcional)</label>
                <select id="filterCampaign"><option value="">Todas</option></select>
            </div>
            <div class="input-group">
                <label for="filterRouter">Roteador (Opcional)</label>
                <select id="filterRouter"><option value="">Todos</option></select>
            </div>
            <div class="input-group">
                <label for="filterStartDate">Data de Início (Cadastro)</label>
                <input type="date" id="filterStartDate">
            </div>
            <div class="input-group">
                <label for="filterEndDate">Data de Fim (Cadastro)</label>
                <input type="date" id="filterEndDate">
            </div>
        </div>
        
        <div class="input-group checkbox-group" style="justify-content: center; margin-top: 15px;">
            <input type="checkbox" id="filterConsent">
            <label for="filterConsent">Apenas utilizadores que aceitaram marketing</label>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-primary">Criar e Carregar Participantes</button>
        </div>
    </form>
</div>

<!-- Tabela de Sorteios Existentes -->
<div class="content-section">
    <div class="section-header">
        <h4>Sorteios Realizados</h4>
    </div>
    <div class="table-container">
        <table id="rafflesTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Título</th>
                    <th>Data do Evento</th>
                    <th>Vencedor</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                <!-- Linhas inseridas via JS -->
            </tbody>
        </table>
    </div>
</div>

<!-- Modal para Detalhes do Sorteio -->
<div id="raffleDetailsModal" class="modal-overlay hidden">
    <div class="modal-content large">
        <button class="modal-close-btn">&times;</button>
        <div id="raffleDetailsContent">
            <!-- Conteúdo inserido via JS -->
        </div>
    </div>
</div>

<!-- Modal para Progresso do Sorteio -->
<div id="raffleProgressModal" class="modal-overlay hidden">
    <div class="modal-content small">
        <h3 id="progressModalTitle">Processando Sorteio...</h3>
        <p id="progressStatusText" style="text-align: center; color: var(--text-secondary); margin-bottom: 15px;">Iniciando...</p>
        <div class="progress-bar-container" style="width: 100%; background-color: var(--background-dark); border-radius: 8px; padding: 4px; border: 1px solid var(--border-color);">
            <div id="progressBar" style="width: 0%; height: 20px; background-color: var(--primary-color); border-radius: 5px; transition: width 0.5s ease;"></div>
        </div>
        <p id="progressPercentage" style="text-align: center; font-weight: bold; margin-top: 10px;">0%</p>
        <!-- O botão de fechar será controlado pelo JS após a conclusão -->
        <div class="modal-actions" id="progressModalActions" style="display: none;">
            <button id="closeProgressModalBtn" class="btn-primary">Fechar</button>
        </div>
    </div>
</div>

<!-- [CORREÇÃO] A biblioteca Socket.io é necessária para esta página e deve ser carregada aqui -->
<!-- [CORRIGIDO] Aponta para o servidor backend (porta 3000) onde o Socket.io está a ser servido -->
<script src="http://127.0.0.1:3000/socket.io/socket.io.js"></script>
<!-- [NOVO] Biblioteca para efeito de confetes -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
